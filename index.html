<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Visor de Imágenes Firebase</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root{ --bg:#f5f5f5; --card:#fff; --ink:#222; --muted:#666; --accent:#2d6cdf;
      --chip:#eef4ff; --ok:#0a7; --warn:#d80; --bad:#c22; }
    *{box-sizing:border-box}
    body{font-family:Arial, sans-serif; margin:0; background:var(--bg); color:var(--ink);}
    header{text-align:center; padding:20px 10px; font-weight:700; font-size:1.6rem;}
    #status{text-align:center; font-size:14px; color:#555; padding:5px 10px;}
    .gallery{display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:14px; padding:18px; max-width:1300px; margin:0 auto 30px;}
    .card{background:var(--card); border-radius:12px; box-shadow:0 3px 10px rgba(0,0,0,.06); overflow:hidden; border:1px solid #eee;}
    .thumb{width:100%; aspect-ratio:4/3; object-fit:cover; display:block; cursor:pointer;}
    .meta{padding:10px 12px; font-size:12px; color:#444; display:grid; gap:6px;}
    .url{color:var(--muted); font-size:11px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
    .kv{display:grid; grid-template-columns:120px 1fr; gap:6px 10px;}
    .kv b{color:#333;}
    .chips{display:flex; gap:6px; flex-wrap:wrap; align-items:center;}
    .chip{background:var(--chip); padding:3px 8px; border-radius:999px; font-size:11px; border:1px solid #dfe8ff;}
    .chip.ok{border-color:#bfeee1; background:#f2fffb}
    .chip.warn{border-color:#ffe3bf; background:#fff8ee}
    .chip.bad{border-color:#ffd4d4; background:#fff3f3}
    .btn-link{display:inline-block; padding:6px 10px; font-size:12px; border-radius:8px; border:1px solid #cbd5e1; text-decoration:none;}
    .btn-link:hover{background:#f1f5f9}

    .modal{display:none; position:fixed; inset:0; background:rgba(0,0,0,.92); z-index:1000; align-items:center; justify-content:center;}
    .modal-inner{display:flex; gap:18px; max-width:94vw; max-height:86vh; align-items:center;}
    .modal img{max-width:62vw; max-height:80vh; border-radius:10px; background:#000;}
    .side{background:#111; color:#e9e9e9; padding:12px 14px; border-radius:10px; max-width:28vw; overflow:auto; max-height:80vh; font-size:13px;}
    .side h4{margin:0 0 8px 0; font-size:14px; color:#fff}
    .side .url{color:#bbb;}
    .side .actions{margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;}
    .close{position:absolute; top:16px; right:22px; font-size:2rem; color:#fff; cursor:pointer; user-select:none;}
    .nav{position:absolute; top:50%; transform:translateY(-50%); font-size:2.2rem; color:#fff; cursor:pointer; user-select:none; padding:8px 12px;}
    .prev{left:18px;} .next{right:18px;}
    #login{text-align:center; margin-top:100px;}
    #login input{display:block; margin:10px auto; padding:8px;}
    #app{display:none;}
  </style>
</head>
<body>
  <!-- Login -->
  <div id="login">
    <h2>Iniciar Sesión</h2>
    <input type="text" id="user" placeholder="Usuario">
    <input type="password" id="pass" placeholder="Contraseña">
    <button onclick="autenticar()">Entrar</button>
  </div>

  <!-- App -->
  <div id="app">
    <header>Visor de Imágenes Firebase</header>
    <div id="status">Conectando a Firebase...</div>
    <div class="gallery" id="gallery"></div>

    <!-- Modal -->
    <div class="modal" id="modal">
      <span class="close" id="btnCerrar" title="Cerrar">&times;</span>
      <span class="nav prev" id="btnPrev" title="Anterior">&#10094;</span>
      <div class="modal-inner">
        <img id="modalImg" src="">
        <div class="side" id="sideMeta">
          <h4>Detalle</h4>
          <div class="kv" id="sideKv"></div>
          <div class="chips" id="sideChips"></div>
          <div class="actions" id="sideActions"></div>
          <div class="url" id="sideUrl"></div>
        </div>
      </div>
      <span class="nav next" id="btnNext" title="Siguiente">&#10095;</span>
    </div>
  </div>

<script>
  // ========= Autenticación sencilla =========
  function autenticar(){
    const u=document.getElementById("user").value;
    const p=document.getElementById("pass").value;
    if(u==="slopezpi" && p==="1234"){
      document.getElementById("login").style.display="none";
      document.getElementById("app").style.display="block";
    } else alert("Usuario o contraseña incorrectos");
  }

  const $=id=>document.getElementById(id);
  const statusMsg=t=>$("status").textContent=t;

  let MATCHES=[];
  let modalIdx=0;

  function renderGallery(rows){
    const g=$("gallery");
    g.innerHTML = rows.map((row, idx) => {
      const url = row.url || '';
      return `
        <div class="card">
          <img class="thumb" data-idx="${idx}" src="${url}" alt="img"/>
          <div class="meta">
            ${row.nic ? `<div class="kv"><b>NIC:</b><span>${row.nic}</span></div>`:""}
            ${row.direccion ? `<div class="kv"><b>Dirección:</b><span>${row.direccion}</span></div>`:""}
            ${row.fecha ? `<div class="kv"><b>Fecha:</b><span>${row.fecha}</span></div>`:""}
            <div class="url" title="${url}">${url}</div>
          </div>
        </div>`;
    }).join('');

    g.querySelectorAll('.thumb').forEach(img => {
      img.addEventListener('click', ev => openModal(Number(ev.currentTarget.dataset.idx)));
    });
  }

  function openModal(i){
    modalIdx=i;
    const row=MATCHES[i];
    if(!row) return;
    $("modalImg").src=row.url;
    $("sideKv").innerHTML=`
      ${row.nic?`<div class="kv"><b>NIC:</b><span>${row.nic}</span></div>`:""}
      ${row.direccion?`<div class="kv"><b>Dirección:</b><span>${row.direccion}</span></div>`:""}
      ${row.fecha?`<div class="kv"><b>Fecha:</b><span>${row.fecha}</span></div>`:""}
    `;
    $("sideChips").innerHTML="";
    $("sideActions").innerHTML="";
    $("sideUrl").textContent=row.url;
    $("sideUrl").title=row.url;
    $("modal").style.display="flex";
  }

  $("btnCerrar").onclick=()=>$("modal").style.display="none";
  $("btnPrev").onclick=()=>{if(modalIdx>0)openModal(modalIdx-1);};
  $("btnNext").onclick=()=>{if(modalIdx<MATCHES.length-1)openModal(modalIdx+1);};
  window.addEventListener('keydown',e=>{if(e.key==='Escape')$("modal").style.display='none';});
</script>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
  import { getFirestore, collection, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  // ⚠️ Pega aquí tu configuración de Firebase
 /* const firebaseConfig = {
    apiKey: "AIzaSyCg89cI09FYVighH86bVA1WrK24XpoQsrg",
    authDomain: "slpvisor.firebaseapp.com",
    projectId: "slpvisor",
    storageBucket: "slpvisor.appspot.com",
    messagingSenderId: "294950446015",
    appId: "TU_APP_ID"
  };*/

    // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyCg89cI09FYVighH86bVA1WrK24XpoQsrg",
    authDomain: "slpvisor.firebaseapp.com",
    projectId: "slpvisor",
    storageBucket: "slpvisor.firebasestorage.app",
    messagingSenderId: "294950446015",
    appId: "1:294950446015:web:a19276d9dc69c58b58370a",
    measurementId: "G-Z9MSKJ2VWQ"
  };

  const app = initializeApp(firebaseConfig);
  const db  = getFirestore(app);

  const galleryRef = collection(db,"gallery");
  const q = query(galleryRef, orderBy("createdAt","desc"));

  onSnapshot(q,snap=>{
    if(snap.empty){
      statusMsg("No hay imágenes en Firebase.");
      $("gallery").innerHTML="<div class='empty'>Sin resultados.</div>";
      return;
    }
    MATCHES = snap.docs.map(d=>({
      url:d.data().url || "",
      nic:d.data().nic || "",
      direccion:d.data().direccion || "",
      fecha:d.data().fecha || ""
    }));
    renderGallery(MATCHES);
    statusMsg(`Cargadas ${MATCHES.length} imágenes desde Firebase.`);
  });
</script>
</body>
</html>
